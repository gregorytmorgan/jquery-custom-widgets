<!DOCTYPE html>
<!--
JQuery Custom Widget Tests
-->
<html>
  <head>
    <title>JQuery Custom Widget Tests</title>
    <link rel="icon" href="favicon.ico" sizes="16x16 32x32 48x48 64x64 96x96 128x128" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src=" https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <style>
      body {
        margin: 0;
      }

      #content {
        overflow: hidden; /* clear the content/layouts */
      }

      .title-block {
        margin: 1em 0 0 1%;
        display: block;
      }

      .container {
        position: relative;
        float: left;
        border: 1px solid black;
        min-height: 64px;
        /* margin: -- specify .full or .half */
        /* width: -- specify .full or .half */
      }

      .container.full {
        margin: 1em 1% 0 1%;
        width: 98%;
      }

      .container.half {
        margin: 1em 0 0 1%;
        width: 48.25%; /* can't use 48.5% due to container borders */
      }

      .container.half:last-child {
        margin-right: 1%;
      }

      .container-label {
        position: absolute;
        border: 0px solid black;
        width: 8em;
        top: -.6em;
        left: 2em;
        background-color: white;
        text-align: center
      }

      .myTimeline {
        margin: 1em 0 0 1em;
      }
    </style>

    <script>
      /**
       * Custom Timeline Widget
       *
       * @type type
       */
      $.widget("custom.timeline", {

        // Default options.
        //
        // Notes:
        // 1) In the case of event handlers, they must be defined here in the options
        // object vs as a regular method for them to be automatically bound.
        options: {
          value: 50,

          /**
           * Default AtStart handler
           *
           * @param {type} event
           * @param {type} data
           * @returns {undefined}
           */
          change: function (event, data) {
            console.log("Default change handler");
          },

          /**
           *
           * @param {type} event
           * @param {type} data
           * @returns {undefined}
           */
          atstart: function (event, data) {
            console.log('Default handler for custom event atStart event');
          },

          /**
           *
           * @param {type} event
           * @param {type} data
           * @returns {undefined}
           */
          atend: function (event, data) {
            console.log('Default handler for custom event atEnd event');
          }
        },

        /*
         * Private methods
         *
         */

        /**
         *
         * @returns {undefined}
         */
        _create: function () {

          this.element.addClass("timeline");

          // chart container
          this._container = $('<div class="timeline-container"></div>').appendTo(this.element);

          this.element.text("Initializing ...");
        },

        /**
         *
         * @param {string} key Option name.
         * @param {mixed} value New value.
         * @returns {undefined}
         * @throws Exception
         */
        _setOption: function (key, value) {
          this._super(key, value);

          // do we need to manually trigger a change event?
          this._trigger("change", null, {key: key, value: value});
        },

        /**
         *
         * @returns {undefined}
         */
        _setOptions: function (options) {
          this._super(options);
        },

        /**
         *
         * @returns {undefined}
         */
        _destroy: function() {
          this.element.removeClass("timeline").text("");
        },

        /*
         * Public methods
         *
         */

        /**
         * Getter/Setter for value.
         *
         * @param {integer} value
         * @returns {Number}
         */
        value: function (value) {
          if (value === undefined) {
            return this.options.value;
          }

          if (value > 100 || value < 0) {
            throw new Error("Invalid value: "  + value);
          }

          this._setOption("value", value)
          this.element.text(this.options.value + "%");
        }
      });

      /*
       * On load handler
       *
       * @returns {undefined}
       */
      window.onload = function () {
        console.log("OnLoad");
      };

      /*
       * Document ready handler
       *
       * @type type
       */
      $(document).ready(function () {
        console.log("documentReady");

        // alternate widget initialization syntax
        // var bar = $.custom.progressbar({}, $("<div></div>").appendTo("body"));

        // create the dom element that is the root of the widget. Could just use the
        // container itself?
        let tlElement = $("<div></div>");

        // construct a timeline widget in the container2 element. We pass
        // in two custom handlers for the atstart' and 'atend' custom events
        tlElement.appendTo("#container2").timeline({
          // override the widgets default initial value.
          value: 20,

          // override the widgets default handler for the custom atstart event
          atstart: function (event, data) {
            console.log('Custom event atStart handler defined at initialization.');
          }
        });

        // Hack way to call method, by calling object and passing in func name
        console.log("Initial value: " + tlElement.timeline("value"));

        // Alternate way of calling widget methods
        let myTimeline = tlElement.data("custom-timeline");
        myTimeline.value(25);
        console.log("Set the value to 25. Value: " + myTimeline.value());

        // Notes:
        // 1) custom handlers are called before the default.
        // 2) Returning false or using stopImmediatePropagation(), stopPropagation()
        // and preventDefault() does not seem to stop the default handler from firing?
        // 3) Note the closure. the hander doesn't have a widget context?
        tlElement.bind("timelinechange", function (event, data) {
          console.log("Custom change handler. Value is " + data.value);

          if (data.value === 0) {
            myTimeline._trigger("atstart", null, {value: 0});
          } else if (data.value === 100) {
            myTimeline._trigger("atend", null, {value: 100});
          }
        });

        myTimeline.value(0);
        console.log("Set the value to 0. Value: " + myTimeline.value());

        myTimeline.value(100);
        console.log("Set the value to 100. Value: " + myTimeline.value());
      });

    </script>

  </head>
  <body>
    <div id="content">
      <div class="title-block">
        <h1>jQuery Custom Widget Tests</h1>
      </div>

      <div id="container1" class="container half">
        <div class="container-label">
          Container #1
        </div>
      </div>

      <div id="container2" class="container half">
        <div class="container-label">
          Container #2
        </div>
      </div>

    </div> <!-- content -->
  </body>
</html>
